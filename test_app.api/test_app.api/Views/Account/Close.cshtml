@model AuthResponseModel

@using test_app.api.Models.Configuration;
@using Microsoft.Extensions.Options;

@inject IOptions<ClientConfigurations> OptionsClientConfigurations

<body>
    <h2 style="text-align: center;" id="countDown"></h2>
    <script type="text/javascript">
        function onAuthed(url) {
            window.opener.postMessage(JSON.stringify({ token: "@Model.Token", username: "@Model.Username" }), url);
            var counter = 5;
            var newElement = document.getElementById("countDown");
            newElement.innerHTML = `The authorization was successful, the window will close automatically ${counter.toString()} seconds`;
            id = setInterval(function() {
                counter--;
                if(counter <= 0) {
                    clearInterval(id);
                    window.close();
                } else {
                    newElement.innerHTML = `The authorization was successful, the window will close automatically ${counter.toString()} seconds`;
                }
            }, 1000);
        };

        var redirectUrl = "@OptionsClientConfigurations.Value.UrlAdmin";
        try {
            onAuthed(redirectUrl);
        } catch (ex) {
            redirectUrl = "@OptionsClientConfigurations.Value.Url";
            onAuthed(redirectUrl);
        }

    //setTimeout(() => {
    //        window.close();
    //    },
    //    3000);
    </script>
</body>